# v6版本主要做了以下修改

1.修复分支指令和jalr指令等部分指令的BUG。

2.扩展GPIO模块，使其支持16个引脚。

3.编写模块的库函数，之前的代码是直接操作寄存器的地址使用，改成库函数风格，定义结构体来表示外设的寄存器组。比如`GPIO_InitTypeDef`，里面包含引脚号、模式等参数。初始化函数GPIO_Init会接收这个结构体，并根据其中的参数配置相应的寄存器。例如，设置GPIO1为输出模式，需要将CTRL寄存器的某些位设置为特定值。

4.增加八段数码管外设

### **数码管外设设计方案**

1. 寄存器定义

   假设外设基地址为 `0x10040000`，定义如下寄存器：

   | 偏移地址 | 寄存器名  | 位宽 | 功能描述                      |
   | :------- | :-------- | :--- | :---------------------------- |
   | `0x00`   | SEG_DATA0 | 8    | 数码管0的段选数据（含小数点） |
   | `0x04`   | SEG_DATA1 | 8    | 数码管1的段选数据             |
   | ...      | ...       | ...  | ...                           |
   | `0x14`   | SEG_DATA5 | 8    | 数码管5的段选数据             |
   | `0x18`   | SEG_CTRL  | 8    | 控制寄存器（使能、扫描频率）  |

2. Verilog 模块代码

   ```
   
   ```

3. 设计说明

4. 软件操作示例

踩坑

1. 程序下载进去发现与预期现象不符，经测试分析，发现代码跳转到 地址0x400228，但是最后一个指令的地址也才0x400224，查阅资料才发现是因为c语言代码中使用了case语句，case语句会被编译成跳转表，而跳转表不在 `.text` 段，而指令 `riscv64-unknown-elf-objdump -d x.elf` 只会反汇编 `.text` 段的内容，需要使用指令 `riscv64-unknown-elf-objdump -s -d x.elf` 才能查看全部的反汇编内容，运行后可以发现如下段，就是跳转表的内容，

   ```
   Contents of section .rodata:
    400228 7c004000 90004000 a4004000 b8004000  |.@...@...@...@.
    400238 cc004000 e0004000                    ..@...@.        
   ```

   - **`objdump -d`** 默认只反汇编 `.text` 段（代码段）中的指令。
   - **跳转表位于 `.rodata` 段**（只读数据段），因此不会被 `-d` 参数反汇编为指令。
   - 需使用 **`-s`** 参数查看 `.rodata` 段的原始数据。

   跳转表的作用

   - 实现 `switch-case` 逻辑，根据数码管位置（0-5）跳转到对应的处理分支。
   - 每个表项存储分支入口地址，通过索引直接跳转，复杂度为 `O(1)`。

   示例

   1. **输入参数**：`a0 = 2`。
   2. **偏移量计算**：`2 × 4 = 8`。
   3. **跳转表项地址**：`0x400228 + 8 = 0x400230`。
   4. **读取目标地址**：`0x4000a4`。
   5. **跳转执行**：`jr 0x4000a4`，进入数码管位置 2 的处理逻辑。



# 后续计划



### 1.扩展外设（GPIO、UART、DDR3 RAM、数码管、定时器、PWM）

### 2.采用AXI+分层总线架构

```
+----------------+     +-----------------+     +---------------+
| RISC-V CPU     |     | AXI Interconnect|     | DDR3 Controller|
| (AXI Master)   |---->|                 |---->| (AXI Slave)    |
+----------------+     +-----------------+     +---------------+
                        |           |
                        |           |  AXI-to-Legacy Bridge
                        |           v
                        |     +-----------------+
                        |     | Legacy Devices  |
                        |     | (RAM/GPIO/Timer)|
                        |     +-----------------+
                        |
                        v（预留DMA接口）
                  +-----------------+
                  | Future AXI Master|
                  | (e.g., DMA)     |
                  +-----------------+
```

### 3.实现CSR寄存器和相关系统指令，支持中断系统

### 4.扩展指令集（M、F、D指令集），支持乘法除法取模求余单双精度浮点数指令

### 5.对SOC时序进行分析